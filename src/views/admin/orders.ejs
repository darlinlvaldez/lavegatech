  <%- include('../admin/dashboard.ejs') %>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="/css/utils/toastify.css">
    <link rel="stylesheet" href="/css/admin/orders.css">
</head>

<div class="main-content">
    <header class="header">
        <h1>Lista de Pedidos</h1>
    </header>

        <main class="main-content-area">
  
        <div class="container-user">
        <h2>Pedidos</h2>

        <div class="search-container">
            <input type="text" id="searchPedidosInput" placeholder="Buscar pedidos..." class="input-search" />
            <i class="fa fa-search search-icon"></i>
        </div>

        <% if (orders.length === 0) { %>
            <div class="alert-info-user">
                No hay pedidos a√∫n.
            </div>
        <% } else { %>
            <div class="list-group-user">
                <% orders.forEach(order => { %>
                    <a href="/api/admin/orders/<%= order.id %>" class="list-group-product order-link" data-order-id="<%= order.id %>">
                        <div class="d-flex-user w-100-user justify-content-user">
                            <h5 class="mb-1">Pedido #<%= order.id %>
                            </h5>
                            <div class="text-right-user">
                                <select class="estado-envio-select" data-pedido_id="<%= order.id %>">
                                    <option value="pendiente" <%=order.estado_envio==='pendiente' ? 'selected' : '' %>>Pendiente</option>
                                    <option value="enviado" <%=order.estado_envio==='enviado' ? 'selected' : '' %>>Enviado</option>
                                    <option value="entregado" <%=order.estado_envio==='entregado' ? 'selected' : '' %>>Entregado</option>
                                    <option value="cancelado" <%=order.estado_envio==='cancelado' ? 'selected' : '' %>>Cancelado</option>
                                </select>
                                <small class="text-muted-user">
                                    <%= new Date(order.fecha_creacion).toLocaleDateString() %>
                                </small>
                            </div>
                        </div>
                        <p class="mb-1-user">
                            <span class="strong-details">Total:</span> $<%= Number(order.total).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, "," ) %>
                            <span class="badge-user <%= order.estado === 'pagado' ? 'bg-success-user' : 'bg-warning-user' %> ms-2">
                                <%= order.estado %>
                            </span>
                        </p>
                        <small class="text-muted-user">
                            <%= order.direccion %>, <%= order.ciudad %>
                        </small>
                    </a>
                <% }); %>
            </div>
        <% } %>
    </div>
  </main>
</div>

<script type="module" src="/js/admin/store/orders.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://unpkg.com/feather-icons"></script>