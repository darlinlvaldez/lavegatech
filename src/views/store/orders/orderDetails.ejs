<%- include('../../partials/header.ejs') %>

<html>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/vendor/toastify.css">
    <link rel="stylesheet" href="/css/store/orderDetails.css">
    <link rel="stylesheet" href="/css/utils/toastify.css">
</html>

</head>
<body>

    <div class="container-details">

        <div class="header-top-details">
            <img src="/img/lavegatech-logo.png" alt="">
            <h2 class="tittle2">Detalles del Pedido #<%= order.id %>
            </h2>
        </div>

        <div class="card-details mb-4">
            <div class="card-header-details">
                <h4 class="tittle4">Información del Pedido</h4>
                <a href="#" class="no-in-pdf" onclick="generatePDF()"><i class="fa-solid fa-file-pdf"></i> Descargar PDF</a>
            </div>
            <div class="card-body-details">
                <div class="row-details">
                    <div class="col-md-6-details">
                        <h5 class="tittle5">Dirección de Envío</h5>
                        <p class="Information-details">
                            <strong>Nombre:</strong> <%= order.name %> <%= order.lastName %><br>
                            <strong>Direccion:</strong> <%= order.address %><br>
                            <strong>Ciudad de envío:</strong> <%= order.shippingCityName %><br>
                            <strong>Distrito:</strong> <%= order.district %><br>
                            <strong>Teléfono:</strong> <%= order.tel %> <br>
                            <strong>Email:</strong> <%= order.email %>
                        </p>
                    </div>
                    <div class="col-md-6-details">
                        <h5 class="tittle5">Detalles</h5>
                        <p class="Information-details">
                            <strong>Fecha:</strong>
                            <%= new Date(order.creationDate).toLocaleString() %><br>
                                <strong>Estado:</strong> <span
                                    class="badge-details <%= order.state === 'pagado' ? 'badge-success-details' : '' %>">
                                    <%= order.state %>
                                </span><br>
                                <strong>Estado de Envío:</strong>
                                <span class="badge-details <%= order.shippingStatus === 'enviado' ? 'badge-warning-details' : 
                                    order.shippingStatus === 'entregado' ? 'badge-success-details' :
                                    order.shippingStatus === 'cancelado' ? 'badge-danger-details' : 
                                    order.shippingStatus === 'pendiente' ? 'badge-pending-details' : '' %>">
                                    <%= order.shippingStatus ? order.shippingStatus.toUpperCase() : 'PENDIENTE' %>
                                </span><br>
                            <strong class="strong-details">Total:</strong> $<%= Number(order.total).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, "," ) %>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-details">
            <div class="card-header-details">
                <h4>Productos</h4>
            </div>
            <div class="card-body-details">
              <div class="table-responsive-mobile">
                <table class="table-details">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Color</th>
                        <th>Cantidad</th>
                        <th>Precio</th>
                        <th>Impuesto</th>
                        <th>Descuento %</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <% order.items.forEach(item => { %>
                        <tr>
                            <td><%= item.productName %> <%= item.specs %></td>
                            <td><%= item.selectedColor?.toUpperCase() || '' %></td>
                            <td><%= item.quantity %></td>
                            <td>$<%= Number(item.unitPrice).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></td>
                            <td>$<%= (item.unitPrice * item.quantity * (item.tax / 100)).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></td>
                            <td>$<%= Number(item.discount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></td>
                            <td>$<%= Number(item.subtotal).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></td>
                        </tr>
                    <% }); %>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="6" style="text-align: right; font-size: 1.2em;">Subtotal</th>
                        <th style="font-size: 1.2em;">$<%= order.items.reduce((sum, item) => sum + Number(item.subtotal || 0), 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></th>
                    </tr>
                    <tr>
                        <th colspan="6" style="text-align: right; font-size: 1.2em;">Envío</th>
                        <th style="font-size: 1.2em;">$<%= Number(order.shippingCityCost || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></th>
                    </tr>
                    <tr>
                        <th colspan="6" style="text-align: right; font-size: 1.2em;">Total</th>
                        <th style="font-size: 1.2em;">$<%= Number(order.total).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") %></th>
                    </tr>
                </tfoot>
            </table>
            </div>
          </div>
        </div>
        <div class="cancel-message">
            <p>
                ¿Algún problema con tu pedido?
                Por favor <strong>contáctanos</strong> a <a href="mailto:info@lavegatechgsrl.com">info@lavegatechgsrl.com</a> o al
                teléfono
                <a href="tel:+18091234567">+1 (809)-277-2371</a>
            </p>
        </div>
        <a href="/api/order/showOrders" class="btn-details no-in-pdf">Volver</a>
        </div>

    <%- include('../../partials/footer.ejs') %>

</body>

	<script src="/js/utils/PDF.js"></script>
    <script src="/js/utils/flashToast.js" type="module"></script>
    <script src="/js/vendor/toastify.js"></script>
	<script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</html>